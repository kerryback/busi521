\documentclass[10pt]{beamer}

\usetheme[progressbar=foot]{metropolis}
\usepackage{appendixnumberbeamer}

\usepackage{booktabs}
\usepackage[scale=2]{ccicons}

\usepackage{pgfplots}
\usepgfplotslibrary{dateplot}
\pgfplotsset{compat=1.18} 

\usepackage{xspace}
\usepackage{xcolor}

\DeclareMathOperator{\stdev}{stdev}
\DeclareMathOperator{\var}{var}
\DeclareMathOperator{\cov}{cov}
\DeclareMathOperator{\corr}{corr}
\DeclareMathOperator{\prob}{prob}
\DeclareMathOperator{\n}{n}
\DeclareMathOperator{\N}{N}
\DeclareMathOperator{\Cov}{Cov}

\newcommand{\hlf}{\frac{1}{2}}
\newcommand{\bi}{\begin{itemize}}
\newcommand{\ei}{\end{itemize}}
\newcommand{\im}{\item}
\newcommand{\D}{\mathrm{d}}
\newcommand{\E}{\mathrm{e}}
\newcommand{\mye}{\ensuremath{\mathsf{E}}}
\newcommand{\myreal}{\ensuremath{\mathbb{R}}}
\newcommand{\bq}{\begin{equation}}
\newcommand{\eq}{\end{equation}}
\newcommand{\eqdef}{\;\buildrel \text{d{}ef}\over = \;}
\newcommand{\xstar}{\buildrel *\over X}
\newcommand{\pmax}{p^{\text{max}}}
\newcommand{\qmax}{q^{\text{max}}}
\newcommand{\bfr}{\begin{frame}}
\newcommand{\bfrp}{\begin{frame}[plain]}
\newcommand{\efr}{\end{frame}}
\newcommand{\F}{\mathcal{F}}
\newcommand{\FF}{\mathbb{F}}
\newcommand{\ve}{\varepsilon}
\newcommand{\lh}{\hat{\lambda}}
\definecolor{mycolor}{gray}{0.8}
\definecolor{mymaincolor}{rgb}{0.6862745098039216,0.9333333333333333,0.9333333333333333}
\newcommand{\alr}[1]{\textcolor{blue}{#1}}
\definecolor{LightCyan}{rgb}{0.88,1,1}
\newcommand{\yel}{\cellcolor{yellow}}
\newcommand{\blue}{\cellcolor{SkyBlue}}
\newcommand{\gr}{\cellcolor{SpringGreen}}
\newcommand{\pink}{\cellcolor{pink}}
\newcommand{\apr}{\cellcolor{Apricot}}
\newcommand{\tve}{\tilde{\varepsilon}}
\newcommand{\tw}{\tilde{w}}
\newcommand{\ttth}{\tilde{\theta}}
\newcommand{\te}{\tilde{e}}
\newcommand{\ts}{\tilde{s}}
\newcommand{\tx}{\tilde{x}}
\newcommand{\ty}{\tilde{y}}
\newcommand{\tv}{\tilde{v}}
\newcommand{\tp}{\tilde{p}}
\newcommand{\tF}{\tilde{F}}
\newcommand{\tf}{\tilde{f}}
\newcommand{\tZ}{\tilde{Z}}
\newcommand{\ow}{\overline{w}}
\newcommand{\tm}{\tilde{m}}
\newcommand{\tc}{\tilde{c}}
\newcommand{\tz}{\tilde{z}}
\newcommand{\tr}{\widetilde{R}}
\newcommand{\tR}{\widetilde{\mathbf{R}}}
\newcommand{\bms}{\begin{multline*}}
\newcommand{\ems}{\end{multline*}}
\newcommand{\bas}{\begin{align*}}
\newcommand{\eas}{\end{align*}}
\newcommand{\qr}{\mathbb{Q}}
\newcommand{\tX}{\tilde{X}}
\newcommand{\tY}{\tilde{Y}}

\setbeamertemplate{frame footer}{BUSI 521/ECON 505, Spring 2024}

\title{Chapter 14: Continuous-Time Portfolio Choice and Pricing}

\date{}
\author{Kerry Back\\ 
BUSI 521/ECON 505\\
Spring 2024\\
Rice University}


\begin{document}

\maketitle

\section{Choice Problem}\subsection{}

\begin{frame}{Portfolio Choice Problem}

An investor chooses consumption process $C$ and portfolio process $\pi$ to 
$$\max \quad \mye \int_0^\infty \E^{-\delta t}u(C_t)\,\D t$$
subject to the intertemporal budget constraint.

 Assume no labor income ($Y=0$).  The intertemporal budget constraint is
$$\frac{\D W}{W} = -\frac{C}{W}\,\D t + r\,\D t+\pi'(\mu-r\iota)\,\D t + \pi'\sigma\,\D B$$

\end{frame}


\begin{frame}{State Variable}
  State variable $X$.  For simplicity, assume it is scalar.  
 Assume 
$$
	\D X_t = \phi(X_t)\,\D t + \nu(X_t)'\,\D B_t\,,
$$
for functions $\phi$ and $\nu$, where~$B$ is the same~$k$--vector of independent Brownian motions that determines the security 
returns.

 Assume the investment opportunity set at date~$t$ depends only on $X_t$.  That is,

\begin{itemize}
    \item  the interest rate is $r(X_t)$,
\item the asset expected returns are $\mu(X_t)$,
\item the asset volatility matrix is $\sigma(X_t)$.
\end{itemize}
\end{frame}


\section{HJB Equation}\subsection{}
\begin{frame}{Hamilton-Jacobi-Bellman Equation}

 At the optimum, the current utility is just enough to offset the loss in value due to the passage of time and discounting and due to the expected change in the value function:
$$ 0 \ = \ \max_{C,\pi} \;\big\{ \; u\,\D t - \delta J\,\D t + \text{drift of $J$}\;\,\big\}
$$
This is the continuous-time version of the equation
\begin{multline*}
    0 \ = \ \max_{\text{controls}} \; \big\{ \text{current reward} \\+ [\text{discounted future value of $J$} - \text{current value of $J$}] \;\big\}
\end{multline*}

 By It\^o's formula, using subscripts to denote partial derivatives,
$$
\text{drift of $J$} = J_w \,\text{drift of $W$} + J_x \,\text{drift of $X$} + \text{second-order terms}
$$
\end{frame}

\begin{frame}
\begin{align*}
\text{drift of $W$} \ &= \ -C + rW + W\pi'(\mu - r\iota)\\ \\ 
\text{drift of $X$} \ &= \ \phi\ \\ \\
(\D W)^2 \ &= \ (W \pi'\sigma\,\D B)(W\pi'\sigma\,\D B)' \ = \ W^2\pi'\Sigma\pi\,\D t\\ \\ 
(\D W)(\D X) \ &= \  (W\pi'\sigma \,\D B)(\nu'\,\D B)' \ = \ W\pi'\sigma\nu\,\D t\\ \\
  (\D X)^2 \ &= \ (\nu'\,\D B)(\nu'\,\D B)' \ = \ \nu'\nu\,\D t\\ \\ 
\end{align*}
\end{frame}

\begin{frame}
The HJB equation is
\begin{multline*} 0 \ = \ \max_{C,\pi} \quad \bigg\{u - \delta J + \big[-C + rW + W\pi'(\mu - r\iota)\big]J_w + \phi J_x \\
+ \frac{1}{2}W^2\pi'\Sigma\pi J_{ww} + W\pi'\sigma\nu J_{wx} 
+ \frac{1}{2}\nu'\nu J_{xx} \bigg\}
\end{multline*}

\end{frame}


\section{FOCs}\subsection{}

\bfr\frametitle{Optimal Consumption (Envelope Condition)}
The FOC for $C$ is 
$$u'(C) = J_w$$
This means that if you are given an extra unit of the consumption good, you could consume it and get $u'$ or save it and get $J_w$ and at the optimum these two values must be equal (you equate marginal values).  

We can invert the marginal utility and solve the envelope condition to compute the optimal consumption as a function of $W$ and $X$:
$$C = \big(u'\big)^{-1}\big(J_w(W,X)\big)$$
For example, if $u=log$ then 
$$u'(C) = J_w \quad \Rightarrow \quad \frac{1}{C} = J_w \quad \Rightarrow \quad C = \frac{1}{J_w}$$
\end{frame}

\bfr\frametitle{Optimal Portfolio}

The FOC for $\pi$ is
$$ WJ_w(\mu-r\iota) + W^2J_{ww}\Sigma\pi + WJ_{wx}\sigma\nu=0$$

We can solve this as 
$$\pi = -\frac{1}{WJ_{ww}}\Sigma^{-1}\bigg[ J_w(\mu-r\iota)+ J_{wx}\sigma\nu\bigg]$$

We can rearrange the solution as
$$\pi = -\frac{J_w}{WJ_{ww}}\Sigma^{-1}(\mu-r\iota)-\frac{J_w}{WJ_{ww}}\frac{J_{xw}}{J_w}\Sigma^{-1} \sigma\nu$$

What are the terms/factors in this formula?
\end{frame}

\begin{frame}[plain]
In the formula for the optimal portfolio, we see relative risk aversion of the value function, the log-optimal portfolio, the sensitivity of the marginal value of wealth to changes in $X$ (namely $\partial \log J_w / \partial x$) and the vector $\Sigma^{-1}\sigma\nu$.

Consider the stochastic part of the portfolio return due to the last term in the optimal portfolio formula.  It is proportional to
$$(\Sigma^{-1}\sigma\nu)'\sigma\,\D B$$

Take the transpose and write out the definition $\Sigma = \sigma\sigma'$.  We have
$$(\Sigma^{-1}\sigma\nu)'\sigma\,\D B \ = \ \nu'\sigma'(\sigma\sigma')^{-1}\sigma\,\D B$$

The row vector in front of $\D B$ is the transpose of the projection of $\nu$ onto the span of the rows of $\sigma$.  It is the portfolio that has maximum correlation with $\D X$.   This part of the portfolio is called the hedging demand.  It hedges changes in $X$.
\end{frame}



\bfr\frametitle{Hedging Demands}
\bi
\im Suppose $J_{wx}>0$.  This means that the marginal value of wealth $J_w$ is larger when $X$ is larger.
\im And suppose that the multiple regression (projection) of $\D X$ on the asset returns has a positive coefficient for some particular asset.  
\im Under these two conditions, an investor holds an extra amount of the asset, because it pays off highly when wealth is needed (it tends to pay when $J_w$ goes up).
\im The investor hedges against $J_w$ rising by holding assets that pay highly when $J_w$ rises.
\im How much of an asset the investor holds to hedge depends on
\bi
\im risk aversion
\im how much $X$ matters ($\partial \log J_w/\partial x$)
\im how much and in what direction the asset covaries with $X$ (more precisely, the size and sign of the multiple regression coefficient).
\ei
\ei
\end{frame}

\section{Log Example}\subsection{}


\begin{frame}{HJB Equation for Log Utility}
For log utility, let's see if there is a solution of the HJB equation 
\begin{multline*} 0 \ = \ \max_{C,\pi} \quad \bigg\{u - \delta J + \big[-C + rW + W\pi'(\mu - r\iota)\big]J_w + \phi J_x \\
+ \frac{1}{2}W^2\pi'\Sigma\pi J_{ww} + W\pi'\sigma\nu J_{wx} 
+ \frac{1}{2}\nu'\nu J_{xx} \bigg\}
\end{multline*}
of the form 
$$J(w,x) = a \log w + f(x)$$
for some constant $a$ and function~$f$.
\end{frame}

\begin{frame}

$J(w,x) = a \log w + f(x)$ implies
 \begin{align*}   
 J_w &=a/W \Rightarrow WJ_w = a\\
 J_{ww}&=-a/W^2 \Rightarrow W^2J_{ww}=-a\\
 J_{wx}&=0\\
 J_x&=f'\\ 
 J_{xx} &= f''
 \end{align*}
 Set $Z=C/W$.
\end{frame}


\begin{frame}{Optimum}
Substituting $\,\Rightarrow$
\begin{multline*} 0 \ = \ \max_{C,\pi} \quad \bigg\{\log Z + \log W - \delta [a \log W + f] \\ + a[-Z + r + \pi'(\mu - r\iota)] + \phi f'\\ 
- \frac{a}{2}\pi'\Sigma\pi  + \frac{1}{2}\nu'\nu f'' \bigg\}
\end{multline*}

The optimal consumption rate is $Z^*=1/a$.  The optimal portfolio solves
$$\max_\pi \; \pi'(\mu-r\iota) - \frac{1}{2}\pi'\Sigma\pi$$
FOC is $\mu-r\iota - \Sigma\pi=0$, so $\pi^* = \Sigma^{-1}(\mu-r\iota)$.

\end{frame}

\begin{frame}{Ordinary Differential Equation}
Substituting $\,\Rightarrow$
\begin{multline*} 0 \ = \ \log W - \log a - \delta a \log W - \delta f \\ 
-1 + ar + \phi f' + \frac{1}{2}\nu'\nu f'' +
 \frac{a}{2}(\mu - r\iota)'\Sigma^{-1}(\mu - r\iota) 
\end{multline*}
For this to be true for all $(W,X)$, the terms involving $W$ and the terms involving $X$ must separately add to zero.  

Equating the $W$ terms to zero yields $a = 1/\delta$, so $Z^* = \delta W$.  

Substituting this and equating the $X$ terms to zero yields
$$ 0= \log \delta - \delta f - 1 + \frac{r}{\delta} + \phi f' +  \frac{1}{2}\nu'\nu f'' +
 \frac{1}{2\delta}(\mu - r\iota)'\Sigma^{-1}(\mu - r\iota) 
$$
This is an ODE in $f$.
\end{frame}


\section{CCAPM}\subsection{}

\begin{frame}{SDF Factor Pricing and Euler Equation}
  \bi 
\im Risk premia depend on covariances with an SDF: for all dividend-reinvested prices $S$,
$$\mye\left[\frac{\D S}{S}\right] -r\,\D t= - \left(\frac{\D S}{S}\right)\left(\frac{\D M}{M}\right)$$
\im This is another way of saying that
$$\mu - r\iota = \sigma\lambda$$
\im Also, we have the Euler equation (FOC):
$$\frac{\E^{-\delta t}u'(C_t)}{u'(C_0)} = M_t$$
\im In other words, MRS is an SDF.  So, risk premia depend on covariances with marginal utility.
\ei
\end{frame}

\begin{frame}{Risk Premia over Short Horizons}
  \bi
    \im In a single period model, risk premia also depend on covariances with marginal utility.
    
    \im What are we going to do that's new here?  Over short horizons, changes in marginal utility can be approximated by changes in consumption (Taylor series).
    
    \im Apply It\^o's formula to $u'(C_t)$ to get
    $$\D u'(C_t) = u''(C_t)\,\D C_t + \text{second-order term}$$
    \im There is no covariance with the second-order term (it is something $\D t$ so `risk-free').  
    
    \im So, over short horizons, risk premia depend on covariances with consumption changes.
    \ei
\end{frame}

\begin{frame}{CRRA example}
  \bi 
  \im Suppose $u(c) = c^{1-\rho}/(1-\rho)$, so
  $$M=\frac{\E^{-\delta t}C_t^{-\rho}}{C_0^{-\rho}} =C_0^\rho\E^{-\delta t}C_t^{-\rho}$$
  \im Then, the stochastic part of $\D M/M$ is ?
  \pause 
  $$\frac{\D M}{M} = -\rho \frac{\D C}{C} + \text{something}\,\D t$$
  \pause
  \im So,
  $$\mye\left[\frac{\D S}{S}\right] -r\,\D t= \rho \left(\frac{\D S}{S}\right)\left(\frac{\D C}{C}\right)$$
  \ei
\end{frame}

\begin{frame}{CCAPM}
  \bi 
\im We don't need to assume CRRA utility.  Use the Euler equation and apply It\^o's formula to $u'(C_t)$.  We get the same formula with $\rho$ replaced by
$$\frac{-C_tu''(C_t)}{u'(C_t)}$$

\im The formula is true for aggregate consumption, even without a representative investor.  Replace RRA with aggregate consumption multiplied by aggregate absolute risk aversion. As usual, aggregate absolute risk aversion is the reciprocal of the sum of the investors' risk tolerances.

\im Risk premia over short periods ($\D t$) equal aggregate relative risk aversion multiplied by the covariance with aggregate consumption growth.
\ei
\end{frame}

\section{ICAPM}\subsection{}
\begin{frame}{ICAPM}
  \bi 
\im Merton's Intertemporal CAPM states that risk premia depend on covariances with the market return plus covariances with the state variables that determine investment opportunities.

\im One proof: Use (i) SDF pricing, (ii)  Euler equation and (iii) envelope condition $u' = J_w$ to see that risk premia depend on covariances with $J_w$.

\im Over short horizons, changes in $J_w$ can be approximated by changes in $W$ and in state variables $X$ (It\^o's formula).  So, over short horizons, risk premia depend on covariances with wealth and state variables.

\im In other words, we add covariances with state variables to the CAPM.
\ei
\end{frame}

\begin{frame}{Portfolio Proof of ICAPM}
  \bi 
\im From previous work,
$$\pi = -\frac{J_w}{WJ_{ww}}\Sigma^{-1}(\mu-r\iota)-\frac{J_w}{WJ_{ww}}\frac{J_{xw}}{J_w}\Sigma^{-1} \sigma\nu$$
\im So,
$$-\frac{WJ_{ww}}{J_w}\Sigma\pi - \frac{J_{xw}}{J_w}\sigma\nu = \mu-r\iota $$
\im What is $\Sigma\pi$? \pause It is the vector of covariances between $\sigma\,\D B$ and $\pi'\sigma\,\D B$.
\pause 
\im What is $\sigma\nu$? \pause It is the vector of covariances between $\sigma\,\D B$ and $\nu'\,\D B$.
\ei 
\end{frame}
\end{document}
